import{h as $,j as e,r as o,u as he,i as me,a as F,b as N,G as c,k as M,C as z,c as A,T as i,f as j,B as u,L as pe,l as G,F as U,I as V,S as Q,m as h,e as _,H as B,M as ge,n as xe,d as be,g as O}from"./index-wmwbL88i.js";import{f as ve,d as je}from"./MoreVert-DPKJp3kE.js";import{A as fe}from"./Alert-BZzf3Gje.js";import{L}from"./LoadingButton-DANd23VG.js";import{T as we,a as Se,b as T,c as I}from"./TabPanel-QAfy5Rcx.js";import{M as f}from"./MenuItem-B9hActxl.js";import{I as Ce}from"./IconButton-D_5O_aqH.js";import{D as E,G as H}from"./DataGrid-B1dt27El.js";import"./KeyboardArrowRight-Bhdmbk5r.js";import"./CircularProgress-Bc2U_Gie.js";import"./FormControlLabel-6915opHp.js";import"./InputAdornment-D2XsZhOP.js";import"./Tooltip-Dotf8hgg.js";const ye=$(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircleOutlined"),ke=$(e.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),Ee=()=>{const[w,d]=o.useState("1"),[S,n]=o.useState(!1),[C,l]=o.useState(!1);he();const y=me(),r=JSON.parse(localStorage.getItem("user")),[k,m]=o.useState([]),[W,p]=o.useState([]),[g,x]=o.useState(null),[t,q]=o.useState(null),[b,J]=o.useState({}),[v,K]=o.useState([]),X=F(a=>xe(`/v1/wallet_withdraw/${r.organization_id}`,a)),Y=F(a=>be(`/v1/loans/repayment/${t.id}/`,a)),[Z,R]=o.useState(!1),ee=()=>{R(!0)},ae=()=>{R(!1)},[te,P]=o.useState(!1),oe=()=>{P(!0)},ne=()=>{P(!1)},re=a=>{console.log("Withdraw data:",a),n(!0),X.mutate(a,{onSuccess:s=>{console.log("Dispatchment successful:",s),_.success(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:B,onClose:()=>{n(!1),location.reload()}})},onError:s=>{console.error("Dispatchment failed:",s),_.error(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:B,onClose:()=>{n(!1),location.reload()}})}})},se=a=>{console.log("Repay data:",a),a.borrower_name=r.organization_name,l(!0),_.success("Loan is being repayd Kindly be patient",{position:"top-right",autoClose:59e3,hideProgressBar:!1,closeOnClick:!0,draggable:!0,progress:void 0,theme:"light",transition:B,onClose:()=>{l(!1)}}),Y.mutate(a,{onSuccess:s=>{console.log("Dispatchment successful:",s),_.success(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:B,onClose:()=>{l(!1),location.reload()}})},onError:s=>{console.error("Dispatchment failed:",s),_.error(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:B,onClose:()=>{l(!1),location.reload()}})}})},ie=(a,s)=>{x(a.currentTarget),q(s)},le=()=>{x(null)},de=a=>{},ce=()=>{y(`/dashboard/borrower/${r.organization_guid}/compliance/edit`)},D=[{field:"reference",headerName:"Reference",width:150},{field:"requested_amount",headerName:"Requested Amount",width:150,valueFormatter:a=>j(a)},{field:"loan_interest",headerName:"Loan Interest",width:120,valueFormatter:a=>`${a}%`},{field:"repayment_amount",headerName:"Repayment Amount",width:150,valueFormatter:a=>j(a)},{field:"repayment_due_date",headerName:"Due Date",width:120,valueFormatter:a=>ve(a)},{field:"remaining_amount",headerName:"Repaid Amount",width:100,valueFormatter:a=>j(a)},{field:"actions",headerName:"Actions",disableExport:!0,width:100,renderCell:a=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{"aria-controls":"menu","aria-haspopup":"true",onClick:s=>ie(s,a.row),children:e.jsx(je,{})}),e.jsxs(ge,{sx:{width:"200px"},id:"menu",anchorEl:g,keepMounted:!0,open:!!g,onClose:le,children:[e.jsx(f,{onClick:()=>de(t==null?void 0:t.guid),children:"View"}),((t==null?void 0:t.status)==="approved"||(t==null?void 0:t.status)==="Partial")&&e.jsx(f,{onClick:()=>oe(),disabled:!r.organization_approved,children:"Repay Loan"})]})]})}];N(["borrower_settings"],()=>O(`/v1/organization_settings/by_org/${r.organization_id}`),{refetchOnWindowFocus:!1,onSuccess:a=>{J(a.data),n(!1)}}),N(["borrower_analytics"],()=>O(`/v1/organization/analytics/by_org/${r.organization_id}`),{refetchOnWindowFocus:!1,onSuccess:a=>{console.log(a.data),K(a.data),n(!1)}}),N(["borrower_approved_loans"],()=>O(`/v1/loans/by_org/${r.organization_id}?status=approved`),{refetchOnWindowFocus:!1,onSuccess:a=>{m(a.data),n(!1)}}),N(["borrower_pending_loans"],()=>O(`/v1/loans/by_org/${r.organization_id}?status=submitted`),{refetchOnWindowFocus:!1,onSuccess:a=>{p(a.data),n(!1)}}),o.useEffect(()=>{n(!1)},[]);const ue=(a,s)=>{d(s)};return e.jsxs(c,{container:!0,spacing:3,sx:{marginTop:"20px"},children:[r.organization_approved?null:e.jsx(e.Fragment,{children:e.jsx(c,{container:!0,justifyContent:"center",children:e.jsx(fe,{variant:"filled",icon:e.jsx(ke,{fontSize:"inherit"}),severity:"warning",action:e.jsx(M,{onClick:ce,color:"inherit",size:"small",sx:{boxShadow:3,":hover":{boxShadow:6}},children:"Complete compliance"}),sx:{maxWidth:600},children:"To be able to make a loan application, complete the compliance module to get approved."})})}),e.jsx(c,{item:!0,xs:12,md:3,order:{xs:1,md:2},children:e.jsx(z,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(A,{children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"My Wallet Balance"}),e.jsxs(i,{variant:"h3",color:"primary",gutterBottom:!0,children:["USD ",j(b==null?void 0:b.wallet_balance)]}),e.jsx("br",{}),e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Wallet Payment Pointer"}),e.jsx(i,{variant:"h4",color:"secondary",gutterBottom:!0,children:b==null?void 0:b.payment_pointer}),e.jsxs(u,{sx:{display:"flex",gap:2,mt:3},children:[e.jsx(L,{variant:"contained",color:"secondary",size:"large",sx:{color:"white"},loading:S,onClick:ee,disabled:!r.organization_approved,children:"Withdraw"}),e.jsx(We,{open:Z,onClose:ae,onSubmit:re}),e.jsx(_e,{open:te,onClose:ne,onSubmit:se})]})]})})}),e.jsx(c,{item:!0,xs:12,md:9,order:{xs:2,md:1},children:e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(z,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(A,{children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Total Borrowed"}),e.jsxs(i,{variant:"h1",color:"primary",children:["USD ",j(v==null?void 0:v.total_borrowed)]})]})})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(z,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(A,{children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Total Repaid"}),e.jsxs(i,{variant:"h1",color:"primary",children:["USD ",j(v==null?void 0:v.total_repaid)]})]})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(z,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(A,{children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"My Loans"}),e.jsx(pe,{to:"/loans/create",style:{textDecoration:"none"},children:e.jsxs(L,{variant:"contained",color:"primary",size:"large",sx:{color:"white"},disabled:!r.organization_approved,children:[e.jsx(ye,{sx:{mr:1}})," Make Loan Application"]})})]}),e.jsx(u,{sx:{width:"100%",typography:"body1"},children:e.jsxs(we,{value:w,children:[e.jsx(u,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(Se,{onChange:ue,"aria-label":"loan status tabs",children:[e.jsx(T,{label:"Approved",value:"1",sx:{fontSize:"1.1rem",fontWeight:"bold"}}),e.jsx(T,{label:"Pending Approval",value:"2",sx:{fontSize:"1.1rem",fontWeight:"bold"}})]})}),e.jsx(I,{value:"1",children:e.jsx(E,{rows:k,columns:D,loading:C,disableDensitySelector:!0,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],slots:{toolbar:H},slotProps:{toolbar:{csvOptions:{allColumns:!0},showQuickFilter:!0}},autoHeight:!0})}),e.jsx(I,{value:"2",children:e.jsx(E,{rows:W,columns:D,disableDensitySelector:!0,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],slots:{toolbar:H},slotProps:{toolbar:{csvOptions:{allColumns:!0},showQuickFilter:!0}},autoHeight:!0})})]})})]})})})]})})]})},We=({open:w,onClose:d,onSubmit:S})=>{const[n,C]=o.useState("mpesa"),[l,y]=o.useState(""),[r,k]=o.useState(""),[m,W]=o.useState(""),[p,g]=o.useState(""),x=()=>{S({withdrawMethod:n,amount:l,phoneNumber:r,bankName:m,bankAccountNumber:p}),d()};return e.jsx(G,{open:w,onClose:d,children:e.jsxs(u,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600,bgcolor:"background.paper",p:4,boxShadow:24},children:[e.jsx(i,{variant:"h3",mb:2,children:"Withdraw"}),e.jsxs(U,{fullWidth:!0,variant:"outlined",margin:"normal",children:[e.jsx(V,{id:"withdraw-method-label",children:"Withdraw Method"}),e.jsxs(Q,{labelId:"withdraw-method-label",value:n,onChange:t=>C(t.target.value),label:"Withdraw Method",children:[e.jsx(f,{value:"mpesa",children:"MPESA"}),e.jsx(f,{value:"bank",children:"Bank"})]})]}),e.jsx(h,{label:"Amount (in USD)",variant:"outlined",fullWidth:!0,margin:"normal",value:l,onChange:t=>y(t.target.value)}),n==="mpesa"&&e.jsx(h,{label:"Phone Number",variant:"outlined",fullWidth:!0,margin:"normal",value:r,onChange:t=>k(t.target.value)}),n==="bank"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{label:"Bank Name",variant:"outlined",fullWidth:!0,margin:"normal",value:m,onChange:t=>W(t.target.value)}),e.jsx(h,{label:"Bank Account Number",variant:"outlined",fullWidth:!0,margin:"normal",value:p,onChange:t=>g(t.target.value)})]}),e.jsxs(u,{sx:{display:"flex",gap:2,mt:3},children:[e.jsx(M,{variant:"contained",color:"primary",onClick:x,children:"Submit"}),e.jsx(M,{variant:"contained",color:"secondary",onClick:d,children:"Cancel"})]})]})})},_e=({open:w,onClose:d,onSubmit:S})=>{const[n,C]=o.useState("mpesa"),[l,y]=o.useState(""),[r,k]=o.useState(""),[m,W]=o.useState(""),[p,g]=o.useState(""),x=()=>{S({withdrawMethod:n,amount:l,phoneNumber:r,bankName:m,bankAccountNumber:p}),d()};return e.jsx(G,{open:w,onClose:d,children:e.jsxs(u,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600,bgcolor:"background.paper",p:4,boxShadow:24},children:[e.jsx(i,{variant:"h3",mb:2,children:"Repay"}),e.jsxs(U,{fullWidth:!0,variant:"outlined",margin:"normal",children:[e.jsx(V,{id:"withdraw-method-label",children:"Withdraw Method"}),e.jsxs(Q,{labelId:"withdraw-method-label",value:n,onChange:t=>C(t.target.value),label:"Withdraw Method",children:[e.jsx(f,{value:"mpesa",children:"MPESA"}),e.jsx(f,{value:"bank",children:"Bank"})]})]}),e.jsx(h,{label:"Amount (in USD)",variant:"outlined",fullWidth:!0,margin:"normal",value:l,onChange:t=>y(t.target.value)}),n==="mpesa"&&e.jsx(h,{label:"Phone Number",variant:"outlined",fullWidth:!0,margin:"normal",value:r,onChange:t=>k(t.target.value)}),n==="bank"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{label:"Bank Name",variant:"outlined",fullWidth:!0,margin:"normal",value:m,onChange:t=>W(t.target.value)}),e.jsx(h,{label:"Bank Account Number",variant:"outlined",fullWidth:!0,margin:"normal",value:p,onChange:t=>g(t.target.value)})]}),e.jsxs(u,{sx:{display:"flex",gap:2,mt:3},children:[e.jsx(M,{variant:"contained",color:"primary",onClick:x,children:"Submit"}),e.jsx(M,{variant:"contained",color:"secondary",onClick:d,children:"Cancel"})]})]})})};export{Ee as default};
