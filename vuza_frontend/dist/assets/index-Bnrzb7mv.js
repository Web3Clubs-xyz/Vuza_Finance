import{r as a,u as I,a as q,b as c,j as e,G as n,C as h,c as p,T as i,f as l,B as g,M as Q,d as U,e as b,H as f,g as m}from"./index-BkwLtTZs.js";import{f as _,d as V}from"./MoreVert-DJv2YjZ7.js";import{T as $,a as K,b as j,c as v}from"./TabPanel-CziJSTlh.js";import{D as S,G as w}from"./DataGrid-2T64eQmx.js";import{I as J}from"./IconButton-uj-dTrfO.js";import{M as B}from"./MenuItem-CJmUos5b.js";import"./KeyboardArrowRight-B-jXHbFr.js";import"./FormControlLabel-CjUZIMk8.js";import"./InputAdornment-CCLjCbJ9.js";import"./Tooltip-gUntIbdj.js";import"./CircularProgress-CnAXhX3U.js";const de=()=>{const[O,F]=a.useState("1"),[X,d]=a.useState(!0);I();const[R,T]=a.useState([]),[A,D]=a.useState([]),[k,M]=a.useState([]),[s,P]=a.useState([]),[C,y]=a.useState(null),[o,W]=a.useState(null),z=(t,r)=>{y(t.currentTarget),W(r)},N=()=>{y(null)},E=t=>{},G=q(t=>U(`/v1/loans/admin_approve/${t.guid}/`,t.payload)),H=t=>{console.log(t);const r={};b.success("Loan is being disbursed Kindly be patient",{position:"top-right",autoClose:59e3,hideProgressBar:!1,closeOnClick:!0,draggable:!0,progress:void 0,theme:"light",transition:f,onClose:()=>{}}),G.mutate({guid:t,payload:r},{onSuccess:u=>{console.log("Approval successful:",u),b.success(u.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:f,onClose:()=>{location.reload()}})},onError:u=>{console.error("Approval failed:",u),b.success(u.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:f,onClose:()=>{}})}})},x=[{field:"borrower_name",headerName:"Borrower",width:180},{field:"loan_interest",headerName:"Loan Interest",width:150,valueFormatter:t=>`${t}%`},{field:"requested_amount",headerName:"Requested Amount",width:150,valueFormatter:t=>l(t)},{field:"repayment_amount",headerName:"Repayment Amount",width:170,valueFormatter:t=>l(t)},{field:"remaining_amount",headerName:"Calculated Balance",width:150,valueFormatter:t=>l(t)},{field:"request_date",headerName:"Request Date ",width:150,valueFormatter:t=>_(t)},{field:"repayment_due_date",headerName:"Repayment Date",width:150,valueFormatter:t=>_(t)},{field:"actions",headerName:"Actions",disableExport:!0,width:100,renderCell:t=>e.jsxs(e.Fragment,{children:[e.jsx(J,{"aria-controls":"menu","aria-haspopup":"true",onClick:r=>z(r,t.row),children:e.jsx(V,{})}),e.jsxs(Q,{sx:{width:"200px"},id:"menu",anchorEl:C,keepMounted:!0,open:!!C,onClose:N,children:[e.jsx(B,{onClick:()=>E(o==null?void 0:o.guid),children:"View"}),(o==null?void 0:o.status)=="approved"?null:e.jsx(B,{onClick:()=>H(o==null?void 0:o.guid),children:"Admin Approval"})]})]})}];c(["rejected_loans"],()=>m("/v1/loans/?status=rejected"),{refetchOnWindowFocus:!1,onSuccess:t=>{T(t.data),d(!1)}}),c(["approved_loans"],()=>m("/v1/loans/?status=approved"),{refetchOnWindowFocus:!1,onSuccess:t=>{D(t.data),d(!1)}}),c(["pending_loans"],()=>m("/v1/loans/?status=submitted"),{refetchOnWindowFocus:!1,onSuccess:t=>{M(t.data),d(!1)}}),c(["admin_analytics"],()=>m("/v1/admin/analytics"),{refetchOnWindowFocus:!1,onSuccess:t=>{P(t.data),d(!1)}}),a.useEffect(()=>{d(!1)},[]);const L=(t,r)=>{F(r)};return e.jsx(n,{container:!0,spacing:3,sx:{marginTop:"20px"},children:e.jsx(n,{item:!0,xs:12,md:12,order:{xs:2,md:1},children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsx(h,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(p,{children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Total Borrowed"}),e.jsxs(i,{variant:"h1",color:"primary",children:["USD ",l(s==null?void 0:s.total_borrowed)]})]})})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsx(h,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(p,{children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Total Repayed"}),e.jsxs(i,{variant:"h1",color:"primary",children:["USD ",l(s==null?void 0:s.total_repaid)]})]})})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsx(h,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(p,{children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Total on Dispatch Pool"}),e.jsxs(i,{variant:"h1",color:"primary",children:["USD ",l(s==null?void 0:s.total_dispatch_pool)]})]})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(h,{sx:{borderRadius:"12px",boxShadow:3},children:e.jsxs(p,{children:[e.jsx(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(i,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"All Loans"})}),e.jsx(g,{sx:{width:"100%",typography:"body1"},children:e.jsxs($,{value:O,children:[e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(K,{onChange:L,"aria-label":"loan status tabs",children:[e.jsx(j,{label:"Pending",value:"1",sx:{fontSize:"1.1rem",fontWeight:"bold"}}),e.jsx(j,{label:"Approved",value:"2",sx:{fontSize:"1.1rem",fontWeight:"bold"}}),e.jsx(j,{label:"Rejected",value:"3",sx:{fontSize:"1.1rem",fontWeight:"bold"}})]})}),e.jsx(v,{value:"1",children:e.jsx(S,{rows:k,columns:x,disableDensitySelector:!0,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],slots:{toolbar:w},slotProps:{toolbar:{csvOptions:{allColumns:!0},showQuickFilter:!0}},autoHeight:!0})}),e.jsx(v,{value:"2",children:e.jsx(S,{rows:A,columns:x,disableDensitySelector:!0,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],slots:{toolbar:w},slotProps:{toolbar:{csvOptions:{allColumns:!0},showQuickFilter:!0}},autoHeight:!0})}),e.jsx(v,{value:"3",children:e.jsx(S,{rows:R,columns:x,disableDensitySelector:!0,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],slots:{toolbar:w},slotProps:{toolbar:{csvOptions:{allColumns:!0},showQuickFilter:!0}},autoHeight:!0})})]})})]})})})]})})})};export{de as default};
