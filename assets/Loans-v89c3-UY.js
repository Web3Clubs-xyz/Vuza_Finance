import{r,a as f,b as P,j as t,T as D,G as d,l as I,m as H,k as T,e as n,H as i,f as x,M as q,d as C,g as G}from"./index-wmwbL88i.js";import{f as c,d as R}from"./MoreVert-DPKJp3kE.js";import{L as z}from"./LatestRecordsTable-BHeNx6OR.js";import{I as K}from"./IconButton-D_5O_aqH.js";import{M as u}from"./MenuItem-B9hActxl.js";import"./DataGrid-B1dt27El.js";import"./KeyboardArrowRight-Bhdmbk5r.js";import"./FormControlLabel-6915opHp.js";import"./InputAdornment-D2XsZhOP.js";import"./Tooltip-Dotf8hgg.js";import"./CircularProgress-Bc2U_Gie.js";const ae=({})=>{const[v,y]=r.useState(!1),[b,j]=r.useState([]),[p,m]=r.useState(null),[a,k]=r.useState(null),[A,l]=r.useState(!1),[h,S]=r.useState(""),_=(e,s)=>{m(e.currentTarget),k(s)},w=()=>{m(null)},O=e=>{},B=e=>{},M=f(e=>C(`/v1/loans/admin_approve/${e.guid}/`,e.payload)),N=e=>{console.log(e);const s={};n.success("Loan is being disbursed Kindly be patient",{position:"top-right",autoClose:59e3,hideProgressBar:!1,closeOnClick:!0,draggable:!0,progress:void 0,theme:"light",transition:i,onClose:()=>{}}),M.mutate({guid:e,payload:s},{onSuccess:o=>{console.log("Approval successful:",o),n.success(o.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:i,onClose:()=>{location.reload()}})},onError:o=>{console.error("Approval failed:",o),n.success(o.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:i,onClose:()=>{}})}})},E=f(e=>C(`/v1/loans/repayment/${e.guid}/`,e.payload)),F=()=>{let e=a.guid;l(!1);const s={repayment_amount:h};n.success("Loan is being repayd Kindly be patient",{position:"top-right",autoClose:59e3,hideProgressBar:!1,closeOnClick:!0,draggable:!0,progress:void 0,theme:"light",transition:i,onClose:()=>{}}),E.mutate({guid:e,payload:s},{onSuccess:o=>{console.log("Approval successful:",o),n.success(o.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:i,onClose:()=>{location.reload()}})},onError:o=>{console.error("Approval failed:",o),n.success(o.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light",transition:i,onClose:()=>{}})}})},g=JSON.parse(localStorage.getItem("user")),L=[{field:"dao_name",headerName:"DAO Pool",width:180},{field:"loan_interest",headerName:"USDC Interest",width:150},{field:"requested_amount",headerName:"Requested Amount",width:150,valueFormatter:e=>x(e)},{field:"remaining_amount",headerName:"Balance",width:150,valueFormatter:e=>x(e)},{field:"request_date",headerName:"Request Date ",width:150,valueFormatter:e=>c(e)},{field:"repayment_due_date",headerName:"Repayment Date",width:150,valueFormatter:e=>c(e)},{field:"approval_date",headerName:"Approval Date",width:150,valueFormatter:e=>c(e)},{field:"status",headerName:"Status",width:150},{field:"actions",headerName:"Actions",disableExport:!0,width:100,renderCell:e=>t.jsxs(t.Fragment,{children:[t.jsx(K,{"aria-controls":"menu","aria-haspopup":"true",onClick:s=>_(s,e.row),children:t.jsx(R,{})}),t.jsxs(q,{sx:{width:"200px"},id:"menu",anchorEl:p,keepMounted:!0,open:!!p,onClose:w,children:[t.jsx(u,{onClick:()=>O(a==null?void 0:a.guid),children:"View"}),t.jsx(u,{onClick:()=>B(a==null?void 0:a.guid),children:"Edit"}),g.organization_id==1?(a==null?void 0:a.status)=="approved"?null:t.jsx(u,{onClick:()=>N(a==null?void 0:a.guid),children:"Admin Approval"}):null,g.organization_id==1||(a==null?void 0:a.status)!="approved"?null:t.jsx(u,{onClick:()=>{l(!0)},children:"Loan Repayment"})]})]})}];return P(["all_loans"],()=>G("/v1/loans/all"),{refetchOnWindowFocus:!1,onSuccess:e=>{j(e.data),y(!1)}}),t.jsxs(t.Fragment,{children:[t.jsx(D,{variant:"h2",children:"Loans"}),t.jsxs(d,{item:!0,lg:12,md:12,sm:12,xs:12,children:[t.jsx(z,{isLoading:v,columns:L,rows:b,title:""}),t.jsx(I,{open:A,onClose:()=>l(!1),children:t.jsx("div",{onClick:()=>l(!1),style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:t.jsx("div",{onClick:e=>e.stopPropagation(),style:{width:"400px",backgroundColor:"white",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:t.jsxs(d,{container:!0,spacing:2,children:[t.jsx(d,{item:!0,xs:12,children:t.jsx(H,{fullWidth:!0,label:"Amount",type:"number",variant:"outlined",value:h,onChange:e=>S(e.target.value)})}),t.jsx(d,{item:!0,xs:12,children:t.jsx(T,{variant:"contained",color:"primary",onClick:()=>F(),children:"Send Amount"})})]})})})})]})]})};export{ae as default};
